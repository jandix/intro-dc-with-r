---
title: "Session 6 - APIs"
subtitle: "An Introduction to Data Collection with R"
author: "Philipp Behrendt & Jan Dix"
date: "05. Juni 2018"
output: 
  ioslides_presentation:
    slide_level: 2
    logo: ../Assets/img/logo-uni.png
    widescreen: true
    css: ../Assets/css/style.css
---

```{r setup, include=FALSE, echo=F, error=F, warning=F, message=F}
knitr::opts_chunk$set(echo = TRUE)

# load required packages
library(tidyverse)
library(httr)
library(ggmap)
library(rtimes)
library(rtweet)
```

## Syllabus

Session 1 - R and RStudio

Session 2 - Data Typen und erste Befehle

Session 3 - Daten einlesen und speichern

Session 4 - Einfache Analyse (numerisch)

Session 5 - Visualisierung

`Session 6 - Application Programming Interfaces (APIs)`

Session 7 - Introduction to Text Mining

Session 8 & 9 - Web Scraping


## Agenda

1. Datenformate
1. Was sind in APIs?
2. Google Maps API
3. New York Times API
4. Twitter API

# Datenformate

## JSON

## XML


# Was sind APIs?

## Was sind APIs? (1)

```{r, out.width = "65%",echo=FALSE, fig.align="center"}
knitr::include_graphics("../Assets/img/session6/api.png", dpi = 300)
```

## Was sind APIs? (2)

```{r, out.width = "100%",echo=FALSE}
knitr::include_graphics("../Assets/img/session6/url.png")
```

**BASE URL** (Stammurl): Wer bietet den Service an?

**ENDPOINT** (Endpunkt): Welchen Service möchtest du nutzten?

**PARAMETER** (Query): Auf welche Daten möchtest du zugreifen? Wie sollen die Daten gefiltert werden? 

## Was sind APIs? (3)

```{r}
library(httr)
url <- parse_url("http://maps.googleapis.com/maps/api/geocode/json")
url$query <- list(
  address = "Konstanz",
  sensor = "false"
)
url <- build_url(url)
```
```{r, echo=FALSE}
url
```

## Aufgaben

Unter [https://developers.google.com/maps/documentation/geocoding/intro](https://developers.google.com/maps/documentation/geocoding/intro) findest du die Dokumentation der Google Maps Geocoding API. Du kannst die Aufgaben entweder mit Hilfe des Browsers oder mit R lösen. **Tipp:** Im `httr` package gibt es die Funktion `GET()`. 

1. Welche Koordinaten hat die Unversität Konstanz?
2. Zu welchem `administrative_area_level_2` gehört die Universität Harvard? 
3. Die API kann sowohl die Daten im `JSON` und `XML` Format ausgeben. Wie kann man das Format ändern?

# APIs in R

## ggmap (1)

```{r, message=F, eval=F}
# Paket laden
library(ggmap)
# Koordinaten für Konstanz
geocode("Konstanz")
```

```{r, echo=F, message=F}
coord <- geocode("Konstanz")
coord
```


```{r, eval=F, message=F}
# 
revgeocode(location = as.numeric(coord[1,]),
           output = "more")
```

## ggmap (2)

## rtimes (1)

- Key beantragen: [https://developer.nytimes.com/signup](https://developer.nytimes.com/signup)
- Key speichern unter `.Renviron`

```{bash, eval=F}
NYTIMES_AS_KEY=***
```

## rtimes (2)

```{r, message=F, eval=F}
# Paket laden
library(rtimes)
#
as_search("")

```

## rtweet

```{r}
library(rtweet)
```
